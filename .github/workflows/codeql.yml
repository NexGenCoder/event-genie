name: 'CodeQL'

on:
   push:
      branches: ['develop', main]
   pull_request:
      branches: ['develop']
   schedule:
      - cron: '15 19 * * 5'

jobs:
   analyze:
      name: Analyze
      runs-on: ubuntu-latest
      permissions:
         actions: read
         contents: read
         security-events: write

      strategy:
         fail-fast: false
         matrix:
            language: ['javascript']

      steps:
         - name: Checkout repository
           uses: actions/checkout@v3

         - name: Set up Node.js
           uses: actions/setup-node@v3
           with:
              node-version: '18'

         - name: Install dependencies
           run: yarn install

         - name: Check Prettier
           run: yarn prettier:check

         - name: Lint code
           run: yarn lint

         # Initializes the CodeQL tools for scanning.
         - name: Initialize CodeQL
           uses: github/codeql-action/init@v2
           with:
              languages: ${{ matrix.language }}

         - name: Autobuild
           uses: github/codeql-action/autobuild@v2

         # If Autobuild fails, remove it and uncomment the following lines to build your code manually
         # - run: |
         #     echo "Run, Build Application using script"
         #     ./location_of_script_within_repo/buildscript.sh

         - name: Perform CodeQL Analysis
           uses: github/codeql-action/analyze@v2
           with:
              category: '/language:${{matrix.language}}'
